<!doctype html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta http-equiv="X-UA-Compatible" content="chrome=1">

        <title>Web GL Fun!</title>

        <script src="/sylvester.js"> </script>
        <script src="/glUtils.js" type="text/javascript"> </script>
        <script src="/gameCode.js" type="text/javascript"> </script>
        <script src="/socket.io/socket.io.js"></script>

        <script id="shader-vs" type="x-shader/x-vertex">
  attribute vec3 vertexPosition;
  attribute vec3 vertexNormal;
  attribute vec2 vertexTexture;
  attribute vec4 vertexTangent;

  uniform mat4 uMVMatrix;
  uniform mat4 uPMatrix;
  uniform mat3 normalMatrix;
  
  uniform mediump vec3 lightPosition;
  uniform mediump float lightingDisabled;
  
  varying mediump vec3 lightDistanceVector;
  varying mediump vec3 lightVector;
  varying mediump vec2 texCoord;
  
  void main(void) 
  {
    vec3 normal=normalMatrix*vertexNormal;
    vec4 vertexTangentA = vec4(normalMatrix*vertexTangent.xyz,vertexTangent.w);
    vec3 bitangent = cross(normal.xyz, vertexTangentA.xyz)*vertexTangentA.w;
    vec4 position=uMVMatrix * vec4(vertexPosition, 1.0);

    lightDistanceVector = lightPosition-position.xyz;
    lightVector = vec3(dot(lightDistanceVector, vertexTangentA.xyz), dot(lightDistanceVector, bitangent), dot(lightDistanceVector, normal));

    gl_Position = uPMatrix * position;
    texCoord = vertexTexture;
  }
</script>

<script id="shader-fs" type="x-shader/x-fragment">
  uniform sampler2D sampler;
  uniform sampler2D normalMap;
  uniform mediump float lightDistance;
  uniform mediump float lightDistance2;
  uniform mediump vec3 lightMaterial;
  uniform mediump vec3 lightMaterial2;
  uniform mediump vec3 lightMaterial3;
  uniform mediump vec2 texCoordAdd;
  uniform mediump float lightingDisabled;
  uniform mediump float kernel[9];
  uniform mediump vec2 bufferTextureSize;

  varying mediump vec3 lightDistanceVector;
  varying mediump vec3 lightVector;
  varying mediump vec2 texCoord;
  
  void main(void) {
        mediump vec3 nNormal = vec3(-(2.0*texture2D(normalMap, texCoord).x - 1.0), (2.0*texture2D(normalMap, texCoord).yz - 1.0));
        
        mediump float distance1 = length(lightDistanceVector);

        mediump vec3 lightDirection = normalize(lightVector);
           
        mediump float dLevel = max(0.0, dot(nNormal, lightDirection));
        mediump float attenuation = min(lightDistance/(distance1*distance1),1.0);
        mediump vec3 lightColor =  dLevel*attenuation*lightMaterial;
       
        gl_FragColor = vec4(lightColor*texture2D(sampler, texCoord).xyz,1);
  }
</script>

        <style>
            html, body {
              width:  100%;
              height: 100%;
              margin: 0px;
              }
            #glCanvas{
            width: 100%;
            }
            body{
            background-color: #000000 
            }
        </style>
    </head>

    <body onload="start()" id="WebPage">

    <!-- Code to tell user how to fix WebGL not working -->
    <div id="placeHolderA" style="display:none;">
        <a href="/webGLFix.html">
            <img src="/warning.png" alt="How to get the game working">
        </a>
    </div>

     <!--  -->
    <div id = "InputBox" style="position: absolute; z-index: 1; left: 50px; top: 164px;background-color: black; color: green;">
        </div>

    <div id = "ChatBox" style="position: absolute; z-index: 1; left: 70%; top: 164px;background-color: black; color: green;">
        </div>

  <canvas id="glCanvas" width="300" height="180" onClick="lockPointer()">
    Your browser doesn't appear to support the HTML5 <code>&lt;canvas&gt;</code> element.
  </canvas>
  <audio id="music1" hidden=true>
  <source src="http://www.thefourthestate.net/OwlieGL/test.wav" type="audio/wav">
  <source src="http://www.thefourthestate.net/OwlieGL/test.wav" type="audio/wav">
</audio>
<audio id="music2" hidden=true>
  <source src="http://www.thefourthestate.net/OwlieGL/test.wav" type='audio/wav' >
</audio>
    </body>
</html>
